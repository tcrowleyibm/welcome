name: welcome
type: resource.web.app
description: Main landing page for the boat tour workload
provides:
  - type: service.web.app
    name: welcomeapp
    description: A web / BFF service for managing access to boat tours
    params:
      - name: message_endpoint
        value: /message
      - name: charters_endpoint
        value: /catalog
      - name: port
        formula: '{{with(index .Needs "environment.properties:appEnvProps")}}{{.Params.welcome_port.Value}}{{end}}'
      - name: imageName
        formula: '{{with(index .Needs "service.container.registry:imageRegistry")}}{{.Params.endpoint.Value}}{{end}}{{.Component.Name}}'
      - name: image.tag
        value: 'latest'
uses:
  - type: environment
    params:
      - name: CHARTERS_URL
        formula: '{{with(index .Needs "environment.properties:appEnvProps")}}{{.Params.catalog_host.Value}}{{end}}{{with(index .Needs "service.web.app:catalogms")}}:{{.Params.port.Value}}{{.Params.charters_endpoint.Value}}{{end}}'
      - name: ORDERS_URL
        formula: '{{with(index .Needs "environment.properties:appEnvProps")}}{{.Params.orders_host.Value}}{{end}}{{with(index .Needs "service.web.app:ordersms")}}:{{.Params.port.Value}}{{.Params.orders_endpoint.Value}}{{end}}'
      - name: WELCOME_PORT
        formula: '{{with(index .Needs "environment.properties:appEnvProps")}}{{.Params.welcome_port.Value}}{{end}}'
      - name: APP_MSG
        formula: '{{with(index .Needs "environment.properties:appEnvProps")}}{{.Params.app_message.Value}}{{end}}'
needs:
  - type: service.web.app
    name: catalogms
    description: Catalog microservice
    params:
      - name: charters_endpoint
        required: true
      - name: port
        required: true
      - name: imageName
        required: true
  - type: service.web.app
    name: ordersms
    description: Orders microservice
    params:
      - name: orders_endpoint
        required: true
      - name: port
        required: true
      - name: imageName
        required: true
  - type: environment.properties
    name: appEnvProps
    description: Application properties
    params:
      - name: app_message
        required: true
      - name: welcome_port
        required: true
      - name: catalog_host
        required: true
      - name: orders_host
        required: true
  - type: service.container.registry
    name: imageRegistry
    params:
      - name: endpoint
        required: true
